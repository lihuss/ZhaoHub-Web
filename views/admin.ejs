<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理面板 - 肇中2025</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body class="app-page">
    <nav class="glass-nav fixed-top p-3 shadow-sm">
        <div class="container d-flex justify-content-between align-items-center">
            <a href="/hall" class="btn btn-sm btn-outline-success"><i class="fas fa-arrow-left"></i> 返回大厅</a>
            <span class="fw-bold fs-5 text-danger">🔒 管理面板</span>
            <span></span>
        </div>
    </nav>

    <div class="container" style="margin-top: 80px; max-width: 800px;">
        <% if (!user || !user.is_admin) { %>
            <div class="alert alert-danger text-center">
                <i class="fas fa-ban fa-2x mb-2"></i>
                <h5>无权访问</h5>
                <p>此页面仅限管理员使用</p>
                <a href="/hall" class="btn btn-outline-danger">返回大厅</a>
            </div>
            <% } else { %>
                <div class="glass-card p-4 mb-4">
                    <h4 class="fw-bold mb-4"><i class="fas fa-key text-warning me-2"></i>生成邀请码</h4>
                    <p class="text-muted">生成系统邀请码供新用户注册使用。这些邀请码不属于任何用户。</p>

                    <form action="/admin/generate-code" method="POST" class="row g-3 align-items-center">
                        <div class="col-auto">
                            <label class="form-label mb-0">生成数量：</label>
                        </div>
                        <div class="col-auto">
                            <select name="count" class="form-select">
                                <option value="1">1个</option>
                                <option value="3">3个</option>
                                <option value="5">5个</option>
                                <option value="10">10个</option>
                            </select>
                        </div>
                        <div class="col-auto">
                            <button type="submit" class="btn btn-warning">
                                <i class="fas fa-plus me-1"></i> 生成邀请码
                            </button>
                        </div>
                    </form>

                    <% if (typeof newCodes !=='undefined' && newCodes && newCodes.length> 0) { %>
                        <div class="alert alert-success mt-4">
                            <strong>✅ 生成成功！新邀请码：</strong>
                            <ul class="mb-0 mt-2">
                                <% newCodes.forEach(code=> { %>
                                    <li><code class="fs-5"><%= code %></code></li>
                                    <% }) %>
                            </ul>
                        </div>
                        <% } %>
                </div>

                <div class="glass-card p-4">
                    <h5 class="fw-bold mb-3"><i class="fas fa-list text-info me-2"></i>系统邀请码列表</h5>

                    <% if (systemCodes.length===0) { %>
                        <p class="text-muted text-center">暂无系统邀请码</p>
                        <% } else { %>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>邀请码</th>
                                            <th>状态</th>
                                            <th>使用者</th>
                                            <th>创建时间</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% systemCodes.forEach(code=> { %>
                                            <tr class="<%= code.used_by ? 'table-secondary' : '' %>">
                                                <td><code><%= code.code %></code></td>
                                                <td>
                                                    <% if (code.used_by) { %>
                                                        <span class="badge bg-secondary">已使用</span>
                                                        <% } else { %>
                                                            <span class="badge bg-success">可用</span>
                                                            <% } %>
                                                </td>
                                                <td>
                                                    <%= code.used_by ? code.used_by : '-' %>
                                                </td>
                                                <td>
                                                    <%= new Date(code.created_at).toLocaleString('zh-CN') %>
                                                </td>
                                            </tr>
                                            <% }) %>
                                    </tbody>
                                </table>
                            </div>
                            <% } %>
                </div>
                <% } %>
    </div>
</body>

</html>